{{define "chat/response.html"}}
{{if .IsComplete}}
<!-- Empty div replaces the polling element, messages loaded via OOB swap -->
<div hx-get="{{.BasePath}}/chat/session/{{.SessionID}}/messages"
     hx-trigger="load"
     hx-swap="none">
</div>
{{else}}
<div id="run-{{.Run.ID}}"
     class="flex justify-start"
     hx-get="{{.BasePath}}/chat/poll/{{.Run.ID}}"
     hx-trigger="every 1s"
     hx-swap="outerHTML">
    <div class="max-w-3xl bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 shadow-sm">
        {{template "processing-indicator" (dict "State" .Run.State)}}

        <!-- Show in-progress tool executions -->
        {{range .ToolExecutions}}
        {{if or (eq .State "pending") (eq .State "running")}}
        <div class="mt-2 p-2 rounded bg-gray-700/50 border border-gray-600">
            <div class="flex items-center space-x-2 text-sm">
                {{template "spinner" (dict "Size" "sm" "Color" "text-purple-400")}}
                <span class="text-gray-300">{{.ToolName}}</span>
                <span class="text-xs text-gray-500">{{.State}}</span>
            </div>
        </div>
        {{end}}
        {{end}}
    </div>
</div>
{{end}}
{{end}}
